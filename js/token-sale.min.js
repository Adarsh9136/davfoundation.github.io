var moreBeneficial=!1;function checkEmail(e){if(validateEmail(e=e.trim()))return kycCheck(e);showErrorMsg($("#error-msg"),"Please enter a valid email address.")}function kycCheck(e){var t="https://nessie.dav.network/status?email="+encodeURIComponent(e);$("#container").addClass("go-out"),$(".kyc-error").hide(),$.ajax({type:"GET",url:t,dataType:"json",success:kycHendler(e)})}function validateOunerDetailsForm(e){var o=!0,t=e.find('[name="ownerAddress"]');(t.val()||(t.addClass("invalid"),o=!1),moreBeneficial)&&e.find("#another-person").find("input").each(function(e,t){input=$(t),input.val()||(input.addClass("invalid"),o=!1)});return o}function validateEmail(e){return/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e)}function iosCopyToClipboard(e){var t=e.contentEditable,o=e.readOnly,a=document.createRange();e.contenteditable=!0,e.readonly=!1,a.selectNodeContents(e);var n=window.getSelection();n.removeAllRanges(),n.addRange(a),e.setSelectionRange(0,999999),e.contentEditable=t,e.readOnly=o,document.execCommand("copy")}function kycHendler(a){return function(e){var t="";ga("send","event","TokenSale-StartButton-Click","click","TokenSale-UserStatus-"+e.statusText);var o=encodeURIComponent(window.localStorage.getItem("dav-referrer"));switch(e.statusText){case"AutoFinish":case"ManualFinish":showHomeAddressForm(a);break;case"Failed":case"CheckRequired":t="Your KYC application is currently being processed.",$(".kyc-response").text("Youâ€™ll receive an email once your application has been processed with next steps."),$(".kyc-button, .kyc-close,.kyc-telegram3").removeClass("hide"),$(".kyc-button").attr("href","/").text("Back To Homepage"),showErrorPage(t);break;case"Rejected":t="Your KYC application has not been accepted.",$(".kyc-response").html("If you believe your KYC has been rejected by mistake we ask that you please resubmit your KYC by clicking the button below. Our systems tell us you should be able to successfully complete your KYC by doing the following:<br><br><b>"+e.suggestionText+"</b>"),$(".kyc-button,.kyc-medium,.kyc-telegram2").removeClass("hide"),$(".kyc-button").attr("href","https://nessie.dav.network/join?email="+encodeURIComponent(a)+"&referrer="+o),showErrorPage(t);break;case"Expired":t="Your KYC application has expired.",$(".kyc-response").text("We ask you to please resubmit your KYC by clicking the button below."),$(".kyc-button, .kyc-close,.kyc-medium,.kyc-telegram2").removeClass("hide"),$(".kyc-button").attr("href","https://nessie.dav.network/join?email="+encodeURIComponent(a)+"&referrer="+o),showErrorPage(t);break;case"Started":window.location.href="https://nessie.dav.network/join?email="+encodeURIComponent(a)+"&referrer="+o}}}function showErrorPage(e){$(".kyc-title").text(e),$(".kyc-title, .kyc-response").removeClass("hide"),$(".right-section .welcome-section").addClass("hide"),$("#container").removeClass("go-out")}function startTokenSale(e){if(!e.contractAddress)return $("#container").removeClass("go-out");ga("send","event","TokenSalePage-LastPage-View","view","TokenSalePage-LastPage-View"),$("#contracts-address").val(e.contractAddress),$(".token-sale").show(),$(".welcome-section, .error, .home-address").addClass("hide"),$(document).scrollTop(-$(document).scrollTop()),$("#container").removeClass("go-out").addClass("sale-page")}function showHomeAddressForm(e){saveTimestamp(e),$(".home-address").removeClass("hide"),$(".welcome-section, .error").addClass("hide"),$("#container").removeClass("go-out").addClass("ouner-details")}function saveTimestamp(e){$.ajax({type:"POST",url:"https://nessie.dav.network/formwatch",data:{email:e},success:function(e){console.log("Timestamp saved")},error:function(e){console.log(e)}})}function showErrorMsg(e,t){e.show(),e.animateCss("shake"),e.text(t)}function forgotWalletAddress(e){$.ajax({type:"GET",url:"https://nessie.dav.network/restorewalletaddress?email="+encodeURIComponent(e),dataType:"json",success:function(e){$("#curtain").removeClass("hide"),$("#modal").removeClass("hide")}})}$(document).ready(function(){var o=$("#email-input"),e=$("#submit-email"),t=$("#email-form"),a=$("#ouner-details-form"),n=$("#another-person"),s=$("#curtain"),i=$(".prompt");function r(){var o=!0;a.find('[type="checkbox"]').each(function(e,t){$(t).is(":checked")||(o=!1)}),o?a.find('[type="submit"]').removeClass("disabled").prop("disabled",!1):a.find('[type="submit"]').addClass("disabled").prop("disabled",!0)}t.submit(function(e){e.preventDefault(),checkEmail(o.val())}),e.click(function(){checkEmail(o.val())}),a.find('input[type="radio"]').click(function(){this.value?(moreBeneficial=!1,n.addClass("hide")):(moreBeneficial=!0,n.removeClass("hide"))}),a.submit(function(e){if(e.preventDefault(),validateOunerDetailsForm(a,moreBeneficial)){$("#container").addClass("go-out");var t=a.serialize();t=t+"&email="+o.val(),$.ajax({type:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},url:"https://nessie.dav.network/tokensalevalidation?",data:t,success:startTokenSale})}}),r(),a.find('[type="checkbox"]').change(r),$("input").focus(function(){$(this).removeClass("invalid")}),$("#copy-to-clipboard").click(function(){var e=document.querySelector("#contracts-address");try{iosCopyToClipboard(e)}finally{e.select(),document.execCommand("copy"),i.removeClass("hide"),setTimeout(function(){i.addClass("hide")},3e3),ga("send","event","CopyToClipboard-Button-Click","click","CopyToClipboard-Button-Click")}}),$("#forgot-wallet-address").click(function(){forgotWalletAddress(o.val()),ga("send","event","ForgotWalletAddress-Button-Click","click","ForgotWalletAddress-Button-Click")}),$("#another-wallet").click(function(){s.removeClass("hide"),$("#another-wallet-modal").removeClass("hide"),ga("send","event","UseAnotherWallet-Button-Click","click","UseAnotherWallet-Button-Click")}),$(".close-button").click(function(){s.addClass("hide"),$("#modal").addClass("hide"),$("#another-wallet-modal").addClass("hide")})}),$.fn.extend({animateCss:function(e,t){var o=function(e){var t={animation:"animationend",OAnimation:"oAnimationEnd",MozAnimation:"mozAnimationEnd",WebkitAnimation:"webkitAnimationEnd"};for(var o in t)if(void 0!==e.style[o])return t[o]}(document.createElement("div"));return this.addClass("animated "+e).one(o,function(){$(this).removeClass("animated "+e),"function"==typeof t&&t()}),this}});